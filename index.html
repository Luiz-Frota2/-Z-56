<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pescadores Artesanais</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --text-color: #374151;
            --text-light: #6b7280;
            --border-color: #d1d5db;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition: all 0.15s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Estilos do cabeçalho atualizados */
        header {
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 24px 0;
            text-align: center;
            margin-bottom: 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .header-img {
            flex: 1;
            text-align: center;
        }
        
        .header-img.left-img {
            text-align: left;
        }
        
        .header-img.right-img {
            text-align: right;
        }
        
        .header-title {
            flex: 2;
            text-align: center;
            padding: 0 15px;
        }
        
        header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--primary-color);
        }
        
        header p {
            font-size: 14px;
            color: var(--text-light);
        }
        
        h1, h2, h3 {
            margin-bottom: 16px;
            color: var(--text-color);
        }
        
        h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background-color: var(--card-bg);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background-color: var(--card-bg);
            color: var(--text-light);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            border-bottom: 2px solid transparent;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            padding: 24px;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 13px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background-color: var(--card-bg);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn i {
            margin-right: 6px;
        }
        
        .btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        
        .btn-outline:hover {
            background-color: rgba(0, 0, 0, 0.02);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 16px;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }
        
        th {
            background-color: #f0f0f0;
            color: var(--text-color);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }
        
        .search-filter {
            background-color: var(--card-bg);
            padding: 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }
        
        .search-filter .form-row {
            margin-bottom: 12px;
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: var(--radius-sm);
        }
        
        .material-table {
            width: 100%;
            margin-top: 16px;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .material-table th, .material-table td {
            border: 1px solid var(--border-color);
            padding: 10px 12px;
            font-size: 13px;
        }
        
        .material-table th {
            background-color: #f0f0f0;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .material-table input {
            background-color: var(--card-bg);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            background-color: #e5e7eb;
            color: #374151;
        }
        
        /* Melhorias na responsividade */
        @media (max-width: 992px) {
            .container {
                padding: 15px;
            }
            
            .tab-content {
                padding: 18px;
            }
            
            .form-row {
                gap: 12px;
            }
            
            th, td {
                padding: 10px 12px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            header {
                padding: 18px 0;
                margin-bottom: 18px;
            }
            
            /* Oculta as imagens apenas em telas pequenas */
            .header-img {
                display: none;
            }
            
            .header-title {
                flex: 1;
                padding: 0;
            }
            
            header h1 {
                font-size: 20px;
                margin: 0 10px;
                line-height: 1.3;
            }
            
            header p {
                font-size: 14px;
                margin-top: 5px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: 1px solid var(--border-color);
                border-left: 2px solid transparent;
                text-align: left;
                padding: 10px 16px;
            }
            
            .tab.active {
                border-bottom: 1px solid var(--border-color);
                border-left: 2px solid var(--primary-color);
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .tab-content {
                padding: 16px;
            }
            
            .search-filter {
                padding: 12px;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 12px;
            }
            
            .material-table th, 
            .material-table td {
                padding: 8px 10px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 18px;
            }
            
            header p {
                font-size: 13px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            input, select, textarea {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .actions {
                flex-direction: column;
                gap: 6px;
            }
            
            .btn-sm {
                width: 100%;
            }
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .print-content, .print-content * {
                visibility: visible;
            }
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
       <header>
            <div class="header-content">
                <div class="header-img left-img">
                    <img src="/-Z-56/imge.jpg" alt="Logo da Colônia" style="height: 90px;">
                </div>
                <div class="header-title">
                    <h1>Sistema de Cadastro de Pescadores Artesanais</h1>
                    <p>Colônia de Pescadores Z-56 de Coari-AM</p>
                </div>
                <div class="header-img right-img">
                    <img src="/-Z-56/imgp.jpg" alt="Brasão" style="height: 90px;">
                </div>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('cadastro')">Cadastro</div>
            <div class="tab" onclick="openTab('listagem')">Listagem</div>
        </div>
        
        <div id="cadastro" class="tab-content active">
            <h2>Cadastro de Pescador Artesanal</h2>
            <form id="pescadorForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome">Nome Completo:</label>
                        <input type="text" id="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="nacionalidade">Nacionalidade:</label>
                        <input type="text" id="nacionalidade" value="brasileiro(a)" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="endereco">Endereço:</label>
                        <input type="text" id="endereco" required>
                    </div>
                    <div class="form-group">
                        <label for="cidade">Cidade:</label>
                        <input type="text" id="cidade" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="estado">Estado:</label>
                        <input type="text" id="estado" required>
                    </div>
                    <div class="form-group">
                        <label for="cep">CEP:</label>
                        <input type="text" id="cep" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rg">Cédula de Identidade (RG):</label>
                        <input type="text" id="rg" required>
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF:</label>
                        <input type="text" id="cpf" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rgp">RGP:</label>
                        <input type="text" id="rgp" required>
                    </div>
                    <div class="form-group">
                        <label for="rgpOrgao">Órgão Emissor:</label>
                        <input type="text" id="rgpOrgao" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="dataInicioAtividade">Data de Início da Atividade Pesqueira:</label>
                    <input type="date" id="dataInicioAtividade" required>
                </div>
                
                <h3>Materiais e Informações Adicionais</h3>
                
                <table class="material-table">
                    <tr>
                        <th>Material</th>
                        <th>Quantidade</th>
                        <th>Especificações</th>
                    </tr>
                    <tr>
                        <td>Malhadeira</td>
                        <td><input type="text" id="malhadeiraQtd" style="width: 50px;"></td>
                        <td><input type="text" id="malhadeiraEspec"></td>
                    </tr>
                    <tr>
                        <td>Canoa</td>
                        <td><input type="text" id="canoaQtd" style="width: 50px;"></td>
                        <td><input type="text" id="canoaEspec"></td>
                    </tr>
                    <tr>
                        <td>Qual Manejo Participa?</td>
                        <td colspan="2"><input type="text" id="manejo"></td>
                    </tr>
                    <tr>
                        <td>Caixa de Isopor</td>
                        <td><input type="text" id="isoporQtd" style="width: 50px;"></td>
                        <td><input type="text" id="isoporEspec"></td>
                    </tr>
                    <tr>
                        <td>Motor de Popa / Rabeta</td>
                        <td><input type="text" id="motorQtd" style="width: 50px;"></td>
                        <td><input type="text" id="motorEspec"></td>
                    </tr>
                    <tr>
                        <td>Arrastão</td>
                        <td><input type="text" id="arrastaoQtd" style="width: 50px;"></td>
                        <td><input type="text" id="arrastaoEspec"></td>
                    </tr>
                    <tr>
                        <td>Casca de Geladeira / Freezer</td>
                        <td><input type="text" id="geladeiraQtd" style="width: 50px;"></td>
                        <td><input type="text" id="geladeiraEspec"></td>
                    </tr>
                    <tr>
                        <td>Quantas pessoas moram na residência?</td>
                        <td colspan="2"><input type="number" id="moradores" style="width: 50px;"></td>
                    </tr>
                    <tr>
                        <td>Recebe Bolsa Família?</td>
                        <td colspan="2">
                            <select id="bolsaFamilia" style="width: 100px;">
                                <option value="Sim">Sim</option>
                                <option value="Não" selected>Não</option>
                            </select>
                        </td>
                    </tr>
                </table>
                
                <div class="btn-group">
                    <button type="button" class="btn" onclick="cadastrarPescador()">Cadastrar</button>
                    <button type="button" class="btn btn-outline" onclick="gerarPDF()">Criar PDF</button>
                    <button type="button" class="btn" onclick="cadastrarEGerarPDF()">Cadastrar e Criar PDF</button>
                    <button type="reset" class="btn btn-outline">Limpar Formulário</button>
                </div>
            </form>
        </div>
        
        <div id="listagem" class="tab-content">
            <h2>Listagem de Pescadores Artesanais</h2>
            
            <div class="search-filter">
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtroNome">Nome:</label>
                        <input type="text" id="filtroNome" onkeyup="filtrarPescadores()" placeholder="Digite para filtrar...">
                    </div>
                    <div class="form-group">
                        <label for="filtroCidade">Cidade:</label>
                        <input type="text" id="filtroCidade" onkeyup="filtrarPescadores()" placeholder="Digite para filtrar...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtroCPF">CPF:</label>
                        <input type="text" id="filtroCPF" onkeyup="filtrarPescadores()" placeholder="Digite para filtrar...">
                    </div>
                    <div class="form-group">
                        <label for="filtroRG">RG:</label>
                        <input type="text" id="filtroRG" onkeyup="filtrarPescadores()" placeholder="Digite para filtrar...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtroMaterial">Possui Material:</label>
                        <select id="filtroMaterial" onchange="filtrarPescadores()">
                            <option value="">Todos</option>
                            <option value="Malhadeira">Malhadeira</option>
                            <option value="Canoa">Canoa</option>
                            <option value="Motor de Popa">Motor de Popa</option>
                            <option value="Arrastão">Arrastão</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroBolsaFamilia">Bolsa Família:</label>
                        <select id="filtroBolsaFamilia" onchange="filtrarPescadores()">
                            <option value="">Todos</option>
                            <option value="Sim">Sim</option>
                            <option value="Não">Não</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <table id="tabelaPescadores">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Cidade</th>
                        <th>RG</th>
                        <th>Materiais</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    <!-- Os dados serão inseridos aqui via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Função para obter o nome do mês por extenso
        function getNomeMes(numeroMes) {
            const meses = [
                "Janeiro", "Fevereiro", "Março", "Abril",
                "Maio", "Junho", "Julho", "Agosto",
                "Setembro", "Outubro", "Novembro", "Dezembro"
            ];
            return meses[numeroMes - 1] || '';
        }
        
        let pescadores = JSON.parse(localStorage.getItem('pescadores')) || [];
        
        // Função para abrir as abas
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'listagem') {
                atualizarListagem();
            }
        }
        
        // Função para cadastrar um novo pescador
        function cadastrarPescador() {
            if (!validarFormulario()) return;
            
            const pescador = {
                id: Date.now(),
                nome: document.getElementById('nome').value,
                nacionalidade: document.getElementById('nacionalidade').value,
                endereco: document.getElementById('endereco').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                cep: document.getElementById('cep').value,
                rg: document.getElementById('rg').value,
                cpf: document.getElementById('cpf').value,
                rgp: document.getElementById('rgp').value,
                rgpOrgao: document.getElementById('rgpOrgao').value,
                dataInicioAtividade: document.getElementById('dataInicioAtividade').value,
                materiais: {
                    malhadeira: {
                        quantidade: document.getElementById('malhadeiraQtd').value,
                        especificacoes: document.getElementById('malhadeiraEspec').value
                    },
                    canoa: {
                        quantidade: document.getElementById('canoaQtd').value,
                        especificacoes: document.getElementById('canoaEspec').value
                    },
                    manejo: document.getElementById('manejo').value,
                    isopor: {
                        quantidade: document.getElementById('isoporQtd').value,
                        especificacoes: document.getElementById('isoporEspec').value
                    },
                    motor: {
                        quantidade: document.getElementById('motorQtd').value,
                        especificacoes: document.getElementById('motorEspec').value
                    },
                    arrastao: {
                        quantidade: document.getElementById('arrastaoQtd').value,
                        especificacoes: document.getElementById('arrastaoEspec').value
                    },
                    geladeira: {
                        quantidade: document.getElementById('geladeiraQtd').value,
                        especificacoes: document.getElementById('geladeiraEspec').value
                    }
                },
                moradores: document.getElementById('moradores').value,
                bolsaFamilia: document.getElementById('bolsaFamilia').value,
                dataCadastro: new Date().toISOString()
            };
            
            pescadores.push(pescador);
            salvarNoLocalStorage();
            
            alert('Pescador cadastrado com sucesso!');
            document.getElementById('pescadorForm').reset();
        }
        
        // Função para validar o formulário
        function validarFormulario() {
            const camposObrigatorios = [
                'nome', 'nacionalidade', 'endereco', 'cidade', 'estado', 'cep',
                'rg', 'cpf', 'rgp', 'rgpOrgao', 'dataInicioAtividade'
            ];
            
            for (const campoId of camposObrigatorios) {
                const campo = document.getElementById(campoId);
                if (!campo.value.trim()) {
                    alert(`Por favor, preencha o campo: ${campo.previousElementSibling.textContent}`);
                    campo.focus();
                    return false;
                }
            }
            
            return true;
        }
        
        // Função para salvar no localStorage
        function salvarNoLocalStorage() {
            localStorage.setItem('pescadores', JSON.stringify(pescadores));
        }
        
        // Função para atualizar a listagem
        function atualizarListagem(filtrados = pescadores) {
            const corpoTabela = document.getElementById('corpoTabela');
            corpoTabela.innerHTML = '';
            
            if (filtrados.length === 0) {
                corpoTabela.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum pescador cadastrado</td></tr>';
                return;
            }
            
            filtrados.forEach(pescador => {
                const tr = document.createElement('tr');
                
                // Lista de materiais que o pescador possui
                const materiais = [];
                if (pescador.materiais.malhadeira.quantidade) materiais.push('Malhadeira');
                if (pescador.materiais.canoa.quantidade) materiais.push('Canoa');
                if (pescador.materiais.motor.quantidade) materiais.push('Motor');
                if (pescador.materiais.arrastao.quantidade) materiais.push('Arrastão');
                
                tr.innerHTML = `
                    <td>${pescador.nome}</td>
                    <td>${formatarCPF(pescador.cpf)}</td>
                    <td>${pescador.cidade}/${pescador.estado}</td>
                    <td>${pescador.rg}</td>
                    <td>${materiais.join(', ')}</td>
                    <td class="actions">
                        <button class="btn btn-sm" onclick="gerarPDF(${pescador.id})">PDF</button>
                        <button class="btn btn-outline btn-sm" onclick="excluirPescador(${pescador.id})">Excluir</button>
                    </td>
                `;
                
                corpoTabela.appendChild(tr);
            });
        }
        
        // Função para filtrar os pescadores
        function filtrarPescadores() {
            const filtroNome = document.getElementById('filtroNome').value.toLowerCase();
            const filtroCidade = document.getElementById('filtroCidade').value.toLowerCase();
            const filtroCPF = document.getElementById('filtroCPF').value.toLowerCase();
            const filtroRG = document.getElementById('filtroRG').value.toLowerCase();
            const filtroMaterial = document.getElementById('filtroMaterial').value;
            const filtroBolsaFamilia = document.getElementById('filtroBolsaFamilia').value;
            
            const filtrados = pescadores.filter(pescador => {
                // Filtro por nome
                if (filtroNome && !pescador.nome.toLowerCase().includes(filtroNome)) {
                    return false;
                }
                
                // Filtro por cidade
                if (filtroCidade && !pescador.cidade.toLowerCase().includes(filtroCidade)) {
                    return false;
                }
                
                // Filtro por CPF
                if (filtroCPF && !pescador.cpf.includes(filtroCPF)) {
                    return false;
                }
                
                // Filtro por RG
                if (filtroRG && !pescador.rg.includes(filtroRG)) {
                    return false;
                }
                
                // Filtro por material
                if (filtroMaterial) {
                    if (filtroMaterial === 'Malhadeira' && !pescador.materiais.malhadeira.quantidade) {
                        return false;
                    }
                    if (filtroMaterial === 'Canoa' && !pescador.materiais.canoa.quantidade) {
                        return false;
                    }
                    if (filtroMaterial === 'Motor de Popa' && !pescador.materiais.motor.quantidade) {
                        return false;
                    }
                    if (filtroMaterial === 'Arrastão' && !pescador.materiais.arrastao.quantidade) {
                        return false;
                    }
                }
                
                // Filtro por Bolsa Família
                if (filtroBolsaFamilia && pescador.bolsaFamilia !== filtroBolsaFamilia) {
                    return false;
                }
                
                return true;
            });
            
            atualizarListagem(filtrados);
        }
        
        // Função para excluir um pescador
        function excluirPescador(id) {
            if (confirm('Tem certeza que deseja excluir este pescador?')) {
                pescadores = pescadores.filter(p => p.id !== id);
                salvarNoLocalStorage();
                atualizarListagem();
            }
        }
        
        // Função para cadastrar e gerar PDF
        function cadastrarEGerarPDF() {
            if (validarFormulario()) {
                cadastrarPescador();
                // O último pescador cadastrado é o que acabamos de adicionar
                gerarPDF(pescadores[pescadores.length - 1].id);
            }
        }
        
        // Função para formatar CPF
        function formatarCPF(cpf) {
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }
        
        // Função para formatar data
        function formatarData(dataISO) {
            const data = new Date(dataISO);
            const dia = data.getDate().toString().padStart(2, '0');
            const mes = (data.getMonth() + 1).toString().padStart(2, '0');
            const ano = data.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }
        
        // Função para gerar PDF
        function gerarPDF(idPescador = null) {
            try { 
                let pescador;
                
                if (idPescador) {
                    pescador = pescadores.find(p => p.id === idPescador);
                    if (!pescador) {
                        alert('Pescador não encontrado!');
                        return;
                    }
                } else {
                    if (!validarFormulario()) return;
                    
                    pescador = {
                        nome: document.getElementById('nome').value,
                        nacionalidade: document.getElementById('nacionalidade').value,
                        endereco: document.getElementById('endereco').value,
                        cidade: document.getElementById('cidade').value,
                        estado: document.getElementById('estado').value,
                        cep: document.getElementById('cep').value,
                        rg: document.getElementById('rg').value,
                        cpf: document.getElementById('cpf').value,
                        rgp: document.getElementById('rgp').value,
                        rgpOrgao: document.getElementById('rgpOrgao').value,
                        dataInicioAtividade: document.getElementById('dataInicioAtividade').value,
                        materiais: {
                            malhadeira: {
                                quantidade: document.getElementById('malhadeiraQtd').value,
                                especificacoes: document.getElementById('malhadeiraEspec').value
                            },
                            canoa: {
                                quantidade: document.getElementById('canoaQtd').value,
                                especificacoes: document.getElementById('canoaEspec').value
                            },
                            manejo: document.getElementById('manejo').value,
                            isopor: {
                                quantidade: document.getElementById('isoporQtd').value,
                                especificacoes: document.getElementById('isoporEspec').value
                            },
                            motor: {
                                quantidade: document.getElementById('motorQtd').value,
                                especificacoes: document.getElementById('motorEspec').value
                            },
                            arrastao: {
                                quantidade: document.getElementById('arrastaoQtd').value,
                                especificacoes: document.getElementById('arrastaoEspec').value
                            },
                            geladeira: {
                                quantidade: document.getElementById('geladeiraQtd').value,
                                especificacoes: document.getElementById('geladeiraEspec').value
                            }
                        },
                        moradores: document.getElementById('moradores').value,
                        bolsaFamilia: document.getElementById('bolsaFamilia').value
                    };
                }
                
                const dataAtual = new Date();
                const dia = dataAtual.getDate().toString().padStart(2, '0');
                const mes = (dataAtual.getMonth() + 1).toString().padStart(2, '0');
                const ano = dataAtual.getFullYear();
                
                // Substitua estas URLs pelas imagens reais do seu documento
                const logoUrl = '/-Z-56/imge.jpg';
                const brasaoUrl = '/-Z-56/imgp.jpg';
                const marcaDaguaUrl = '/-Z-56/fundo.jpg';
                
                const html = `
                <div style="font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; padding: 10px; position: relative; page-break-inside: avoid; transform: scale(0.95); transform-origin: top center;">
                    <!-- Marca d'água -->
                    <div style="position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); z-index: -1;">
                        <img src="${marcaDaguaUrl}" style="width: 550px;">
                    </div>
                    <!-- Cabeçalho com imagens -->
                    <div style="text-align: center; margin-bottom: 20px; position: relative;">
                        <div style="position: absolute; left: 0; top: 0;">
                            <img src="${logoUrl}" style="height: 80px;">
                        </div>
                        <div style="position: absolute; right: 0; top: 0;">
                            <img src="${brasaoUrl}" style="height: 80px;">
                        </div>
                        
                        <h2 style="margin: 0; font-size: 16px; text-transform: uppercase;">COLÔNIA DE PESCADORES Z-56 DE COARI-AM</h2>
                        <p style="margin: 5px 0; font-size: 12px; line-height: 1.3;">
                            <em>FILIADA A CONFEDERAÇÃO NACIONAL DOS PESCADORES E AQUICULTORES - CNPA</em><br>
                            <em>E FEDERAÇÃO DOS PESCADORES DO ESTADOS DO AMAZONAS - FEPESCA</em><br>
                            <em>FUNDADA EM 28/08/2005 (COLPESCA-Z-56)</em><br>
                            <em>RUA: ANTONIO F DE CARVALHO, Nº72 – UNIÃO.</em><br>
                            <em>EMAIL: coloniaz58am@gmail.com</em><br>
                            <em>CNPJ: 07.618.675/0001-48    CEP: 69.460-000    FONE: (97) 99150-8481</em>
                        </p>
                    </div>
                    
                    <!-- Título principal -->
                    <h1 style="text-align: center; margin-bottom: 30px; font-size: 18px; text-transform: uppercase; text-decoration: underline;">
                        DECLARAÇÃO PESCADOR ARTESANAL
                    </h1>
                    
                    <!-- Corpo do documento -->
                    <div style="margin-bottom: 20px; text-align: justify; font-size: 14px; line-height: 1.5;">
                        <p>
                            Eu, <strong>${pescador.nome}</strong>, ${pescador.nacionalidade}, residente e 
                            domiciliado(a) no endereço: <strong>${pescador.endereco}, ${pescador.cidade}/${pescador.estado}, CEP: ${pescador.cep}</strong>,
                            portador(a) da cédula de identidade nº <strong>${pescador.rg}</strong> e inscrito sob o número de
                            CPF: <strong>${formatarCPF(pescador.cpf)}</strong>, RGP: <strong>${pescador.rgp}</strong> de <strong>${pescador.rgpOrgao}</strong>.
                            Declaro para os devidos fins e sob as penas da lei, que exerço de forma artesanal e de economia
                            familiar a atividade da pesca desde <strong>${formatarData(pescador.dataInicioAtividade)}</strong>, afim de ratificar tal pratica, 
                            declaro ainda que possuo de minha propriedade os utensílios a seguir sinalados.
                        </p>
                    </div>
                    
                    <!-- Tabela de materiais -->
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px;">
                        <tr>
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 40%;">MATERIAL</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 20%;">QUANTIDADE</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 40%;">ESPECIFICAÇÕES</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Malhadeira</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.malhadeira.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.malhadeira.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Canoa</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.canoa.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.canoa.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Qual Manejo Participa?</td>
                            <td colspan="2" style="border: 1px solid #000; padding: 8px;">${pescador.materiais.manejo || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Caixa de Isopor</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.isopor.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.isopor.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Motor de Popa / Rabeta</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.motor.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.motor.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Arrastão</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.arrastao.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.arrastao.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Casca de Geladeira / Freezer</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.geladeira.quantidade || ''}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${pescador.materiais.geladeira.especificacoes || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Quantas pessoas moram na residência?</td>
                            <td colspan="2" style="border: 1px solid #000; padding: 8px;">${pescador.moradores || ''}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">Recebe Bolsa Família?</td>
                            <td colspan="2" style="border: 1px solid #000; padding: 8px;">${pescador.bolsaFamilia || 'Não'}</td>
                        </tr>
                    </table>
                    
                    <!-- Texto final -->
                    <div style="margin-bottom: 20px; text-align: justify; font-size: 14px; line-height: 1.5;">
                        <p>
                            Declaro ainda, que todas as informações por mim prestadas, são verdadeiras, ciente das
                            penalidades previstas no artigo 299 e Lei nº 7.115, de 29 de agosto de 1983. Sem mais, é o que
                            tenho a declarar, a quem possa interessar.
                        </p>
                    </div>
                    
                    <!-- Rodapé com assinaturas -->
                    <div style="margin-top: 50px; text-align: center; font-size: 14px;">
                        <p>Coari – AM, ${dia} de ${getNomeMes(parseInt(mes))} de ${ano}</p>
                        
                        <div style="margin-top: 50px;">
                            <p>_________________________________________</p>
                            <p>Assinatura do Pescador(a)</p>
                        </div>
                        
                        <div style="margin-top: 40px;">
                             <p>_________________________________________</p>
                            <p>Maria Socorro Corrêa da Silva</p>
                            <p>Secretária Geral da Colônia de Pescadores Z -56 de Coari-AM</p>
                            
                        </div>
                    </div>
                    
                    <!-- Frase final -->
                    <div style="text-align: center; margin-top: 30px; font-style: italic; font-size: 12px;">
                        <p>Alegrai-vos e exultai, porque será grande a vossa recompensa nos céus.</p>
                    </div>
                </div>
                `;

                const janela = window.open('', '_blank');
                janela.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Declaração de Pescador Artesanal - ${pescador.nome}</title>
                        <style>
                            body { 
                                font-family: 'Times New Roman', serif; 
                                margin: 0;
                                padding: 0;
                                background-color: #fff;
                            }
                            @media print {
                                body { 
                                    margin: 0; 
                                    padding: 0; 
                                    background: none;
                                    height: 100%;
                                }
                                .no-print { display: none; }
                                @page { 
                                    size: A4; 
                                    margin: 5mm 10mm;
                                }
                                .print-content {
                                    page-break-inside: avoid;
                                    height: 100%;
                                }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="print-content">
                            ${html}
                        </div>
                        <div class="no-print" style="text-align: center; margin-top: 20px; padding: 20px;">
                            <button onclick="window.print()" style="padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Imprimir Declaração
                            </button>
                            <button onclick="window.close()" style="padding: 10px 20px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                                Fechar Janela
                            </button>
                        </div>
                    </body>
                    </html>
                `);

                janela.document.close();
            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                alert("Ocorreu um erro ao gerar o PDF. Verifique o console para mais detalhes.");
            }
        }
    </script>
</body>
</html>
